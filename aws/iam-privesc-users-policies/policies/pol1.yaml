---
metadata:
  id: "POL1"
  name: "Ensure AWS IAM policy does not allow risk of Privilege Escalation."
  category: "IAM"
definition:
  or:
    - cond_type: "attribute"
      resource_types:
        - "aws_iam_policy"
        - "aws_iam_role_policy"
        - "aws_iam_group_policy"
        - "aws_iam_user_policy"
      attribute: "policy.Statement[?(@.Effect == Allow)].Action[*]"
      operator: "jsonpath_not_subset"
      value:
        - "iam:CreateAccessKey"
        - "iam:CreateLoginProfile"
        - "iam:Create*"
        - "iam:UpdateLoginProfile"
        - "iam:Update*"
        - "iam:AddUserToGroup"
        - "iam:Add*"
        - "iam:CreatePolicyVersion"
        - "iam:SetDefaultPolicyVersion"
        - "iam:Set*"
        - "iam:AttachUserPolicy"
        - "iam:AttachGroupPolicy"
        - "iam:AttachRolePolicy"
        - "iam:Attach*"
        - "iam:PutUserPolicy"
        - "iam:PutGroupPolicy"
        - "iam:PutRolePolicy"
        - "iam:Put*"
        - "iam:*"
        - "*"
    - cond_type: "attribute"
      resource_types:
        - "aws_ssoadmin_permission_set_inline_policy"
      attribute: "inline_policy.Statement[?(@.Effect == Allow)].Action[*]"
      operator: "jsonpath_not_subset"
      value:
        - "iam:CreateAccessKey"
        - "iam:CreateLoginProfile"
        - "iam:Create*"
        - "iam:UpdateLoginProfile"
        - "iam:Update*"
        - "iam:AddUserToGroup"
        - "iam:Add*"
        - "iam:CreatePolicyVersion"
        - "iam:SetDefaultPolicyVersion"
        - "iam:Set*"
        - "iam:AttachUserPolicy"
        - "iam:AttachGroupPolicy"
        - "iam:AttachRolePolicy"
        - "iam:Attach*"
        - "iam:PutUserPolicy"
        - "iam:PutGroupPolicy"
        - "iam:PutRolePolicy"
        - "iam:Put*"
        - "iam:*"
        - "*"
    - cond_type: "attribute"
      resource_types:
      - "data.aws_iam_policy_document"
      attribute: "statement[?(@.effect == Allow)].actions[*]"
      operator: "jsonpath_not_subset"
      value:
        - "iam:CreateAccessKey"
        - "iam:CreateLoginProfile"
        - "iam:Create*"
        - "iam:UpdateLoginProfile"
        - "iam:Update*"
        - "iam:AddUserToGroup"
        - "iam:Add*"
        - "iam:CreatePolicyVersion"
        - "iam:SetDefaultPolicyVersion"
        - "iam:Set*"
        - "iam:AttachUserPolicy"
        - "iam:AttachGroupPolicy"
        - "iam:AttachRolePolicy"
        - "iam:Attach*"
        - "iam:PutUserPolicy"
        - "iam:PutGroupPolicy"
        - "iam:PutRolePolicy"
        - "iam:Put*"
        - "iam:*"
        - "*"